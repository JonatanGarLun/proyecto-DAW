<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Jonatan GarcÃ­a Luna">
    <link rel="shortcut icon" href="../img/favicon.ico">
    <title>âš”ï¸ LÃ³gica del combate &mdash; Battlebound Tactics</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/tonsky/FiraCode@1.206/distr/fira_code.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../css/theme.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script> 
</head>

<body ontouchstart="">
    <div id="container">
        <aside>
            <div class="home">
                <div class="title">
                    <button class="hamburger"></button>
                    <a href=".." class="site-name"> Battlebound Tactics</a>
                </div>
                <div class="search">
                    <div role="search">
    <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
        <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
    </form>
</div>
                </div>
            </div>
            <nav class="nav">
                <ul class="root">
                    <li class="toctree-l1"><a class="nav-item" href="..">ğŸ  PresentaciÃ³n</a></li>
                    <li class="toctree-l1"><a class="nav-item" href="../modelos/">ğŸ“¦ Modelos del Proyecto</a></li>
                    <li class="toctree-l1"><a class="nav-item" href="../vistas/">ğŸ–¥ï¸ Vistas de Django</a></li>
                    <li class="toctree-l1 current"><a class="nav-item current" href="./">âš”ï¸ LÃ³gica del combate</a>
<ul class="subnav">
<li class="toctree-l2"><a class="nav-item toc" href="#modulos">MÃ³dulos</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#autorizacion-y-control-de-acceso">ğŸ¬ AutorizaciÃ³n y control de acceso</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#inicializacion-del-combate">âš™ï¸ InicializaciÃ³n del combate</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#aplicacion-de-efectos-al-inicio-del-turno">ğŸ’¡ AplicaciÃ³n de efectos al inicio del turno</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#procesamiento-de-la-accion-del-jugador">ğŸ“¥ Procesamiento de la acciÃ³n del jugador</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#prioridad-por-velocidad">â±ï¸ Prioridad por velocidad</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#ciclo-de-turnos">ğŸ” Ciclo de turnos</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#deteccion-de-dano-y-animacion">ğŸ’¢ DetecciÃ³n de daÃ±o y animaciÃ³n</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#persistencia-de-las-estadisticas">ğŸ’¾ Persistencia de las estadÃ­sticas</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#renderizado-de-la-vista">ğŸ§¾ Renderizado de la vista</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#funciones-clave-utilizadas">ğŸ“ˆ Funciones clave utilizadas</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#vista-resultado_combate">ğŸ Vista resultado_combate</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#flujo-completo-del-combate">ğŸ”„ Flujo completo del combate</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#reflexion">ğŸ§  ReflexiÃ³n</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">ğŸ§  MÃ³dulos de core/</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../core-jugador/">Jugador</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../core-enemigos/">Enemigos</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../core-efectos/">Efectos</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../core-estadisticas/">EstadÃ­sticas</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../core-probabilidades/">Probabilidades</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../core-utils-combate/">Utilidades de Combate</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../core-utils-resolvedor/">ResoluciÃ³n de Turnos</a></li>
</ul></li>
                    <li class="toctree-l1"><a class="nav-item" href="../api/">ğŸ§© API y Endpoints Externos</a></li>
                    <li class="toctree-l1"><a class="nav-item" href="../despliegue/">ğŸš€ Despliegue y ConfiguraciÃ³n</a></li>
                    <li class="toctree-l1"><a class="nav-item" href="../conclusiones/">ğŸ§¾ Conclusiones</a></li>
                </ul>
            </nav>
            <div class="repo">
    <div class="link">
        <a href="https://github.com/JonatanGarLun/proyecto_DAW" class="fa fa-github"> GitHub</a>
    </div>
    <div class="previous"><a href="../vistas/">&laquo; Previous</a></div>
    <div class="next"><a href="../core-jugador/">Next &raquo;</a></div>
</div>
        </aside>
        <div id="spacer"><button class="arrow"></button></div>
        <main>
            <div class="home-top">
                <button class="hamburger"></button>
                <a href=".." class="site-name"> Battlebound Tactics</a>
            </div>
            <div id="main">
                <nav class="breadcrumbs">
<ul>
    
</ul>
</nav>
                <div id="content"><h1 id="vista-de-combate-combaterequest-combate_id">âš”ï¸ Vista de Combate: <code>combate(request, combate_id)</code><a class="headerlink" href="#vista-de-combate-combaterequest-combate_id" title="Permanent link">&para;</a></h1>
<p><strong>Decoradores</strong>: <code>@login_required</code><br />
<strong>ParÃ¡metros</strong>:</p>
<ul>
<li><code>request</code>: la solicitud del jugador.</li>
<li><code>combate_id</code>: identificador del combate actual.</li>
</ul>
<p>La vista <code>combate</code> es el corazÃ³n del sistema jugable de Battlebound Tactics. AquÃ­ ocurre toda la lÃ³gica de combate por
turnos entre el jugador y el enemigo. Esta vista gestiona turnos, efectos de estado, resoluciÃ³n de acciones,
condiciones de victoria o derrota y sincronizaciÃ³n del estado del combate.</p>
<h3 id="modulos">MÃ³dulos<a class="headerlink" href="#modulos" title="Permanent link">&para;</a></h3>
<ul>
<li>Si desea conocer mÃ¡s a fondo los mÃ³dulos que componen Battlebound Tactics, puede echar un vistazo a esta tabla de
  contenidos, en ella, podrÃ¡s encontrar enlaces a la documentaciÃ³n de cada archivo</li>
</ul>
<div class="tabbed-set" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><label for="__tabbed_1_1">ğŸ® MÃ³dulos del juego, dentro de <code>core/</code></label><div class="tabbed-content"></div>
</div>
<table>
<thead>
<tr>
<th>MÃ³dulo</th>
<th>DescripciÃ³n</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../core-jugador/"><code>jugador.py</code></a></td>
<td>Controla la lÃ³gica del jugador durante el combate: ataques, habilidades, energÃ­a, salud.</td>
</tr>
<tr>
<td><a href="../core-enemigos/"><code>enemigos.py</code></a></td>
<td>Implementa la IA enemiga. Decide acciones segÃºn el estado del combate, controla habilidades y cooldowns.</td>
</tr>
<tr>
<td><a href="../core-efectos/"><code>efectos.py</code></a></td>
<td>Sistema de estados: veneno, buffs, debuffs, curaciones. Aplica y gestiona sus duraciones y efectos.</td>
</tr>
<tr>
<td><a href="../core-estadisticas/"><code>estadisticas.py</code></a></td>
<td>Calcula estadÃ­sticas finales del jugador/enemigo: ataque, defensa, velocidad, etc. segÃºn nivel, pasiva y equipo.</td>
</tr>
<tr>
<td><a href="../core-probabilidades/"><code>probabilidades.py</code></a></td>
<td>Define y gestiona las probabilidades de efectos como crÃ­ticos, evasiÃ³n, adicionales, etc.</td>
</tr>
<tr>
<td><a href="../core-utils-combate/"><code>utils_combate.py</code></a></td>
<td>Funciones auxiliares para interpretar efectos y habilidades.</td>
</tr>
<tr>
<td><a href="../core-utils-resolvedor/"><code>utils_resolvedor.py</code></a></td>
<td>Controla la secuencia de turnos, efectos globales por turno, condiciones de victoria o derrota.</td>
</tr>
<tr>
<td><a href="../core-session/"><code>session.py</code></a></td>
<td>Controla la secuencia de turnos, efectos globales por turno, condiciones de victoria o derrota.</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="autorizacion-y-control-de-acceso">ğŸ¬ AutorizaciÃ³n y control de acceso<a class="headerlink" href="#autorizacion-y-control-de-acceso" title="Permanent link">&para;</a></h2>
<p>Al comenzar, se recupera el combate mediante su ID. Se verifica que el usuario autenticado sea el propietario del
combate. Si no lo es, se bloquea el acceso lanzando una excepciÃ³n. AdemÃ¡s, si el combate ya ha terminado, se redirige
automÃ¡ticamente a la vista de resultado, para evitar que se repita o se acceda a un estado inconsistente.</p>
<hr />
<h2 id="inicializacion-del-combate">âš™ï¸ InicializaciÃ³n del combate<a class="headerlink" href="#inicializacion-del-combate" title="Permanent link">&para;</a></h2>
<p>Se inicializan las estadÃ­sticas del jugador y del enemigo a travÃ©s de una funciÃ³n especÃ­fica que calcula salud, energÃ­a,
velocidad, evasiÃ³n, daÃ±o y otros modificadores. Esto incluye factores como la clase del jugador, su equipo, su nivel y
sus pasivas.</p>
<p>TambiÃ©n se crea una copia temporal del estado del enemigo antes del turno. Esto servirÃ¡ mÃ¡s adelante para saber si
recibiÃ³ daÃ±o, y mostrar una animaciÃ³n de impacto.</p>
<hr />
<h2 id="aplicacion-de-efectos-al-inicio-del-turno">ğŸ’¡ AplicaciÃ³n de efectos al inicio del turno<a class="headerlink" href="#aplicacion-de-efectos-al-inicio-del-turno" title="Permanent link">&para;</a></h2>
<p>Al inicio de cada turno se aplican los efectos de estado activos en cada personaje. Primero se aplican los efectos del
enemigo, otorgÃ¡ndole una ligera ventaja al jugador. Luego, se aplican los del jugador. Estos efectos pueden ser
beneficiosos (curaciÃ³n, aumentos de defensa) o perjudiciales (veneno, reducciÃ³n de estadÃ­sticas).</p>
<p>Si alguno de los dos muere por un efecto, se detiene el flujo, se asigna una victoria o derrota al combate y se redirige
a la vista de resultado correspondiente</p>
<hr />
<h2 id="procesamiento-de-la-accion-del-jugador">ğŸ“¥ Procesamiento de la acciÃ³n del jugador<a class="headerlink" href="#procesamiento-de-la-accion-del-jugador" title="Permanent link">&para;</a></h2>
<p>Cuando el jugador realiza una acciÃ³n (por ejemplo, atacar o usar una habilidad), esta llega a travÃ©s de un formulario.
Si no se detecta ninguna acciÃ³n, se muestra un mensaje de error en el registro del combate.</p>
<hr />
<h2 id="prioridad-por-velocidad">â±ï¸ Prioridad por velocidad<a class="headerlink" href="#prioridad-por-velocidad" title="Permanent link">&para;</a></h2>
<p>Antes de ejecutar los turnos, se compara la estadÃ­stica de velocidad del jugador y del enemigo. Quien tenga mÃ¡s
velocidad actÃºa primero. Si estÃ¡n empatados, el jugador tiene prioridad.</p>
<hr />
<h2 id="ciclo-de-turnos">ğŸ” Ciclo de turnos<a class="headerlink" href="#ciclo-de-turnos" title="Permanent link">&para;</a></h2>
<p>Dependiendo de quiÃ©n actÃºe primero, se siguen dos posibles flujos:</p>
<h3 id="si-el-jugador-actua-primero">Si el jugador actÃºa primero:<a class="headerlink" href="#si-el-jugador-actua-primero" title="Permanent link">&para;</a></h3>
<ol>
<li>El jugador realiza su acciÃ³n.</li>
<li>Si el enemigo muere, el combate termina con victoria.</li>
<li>Si sigue vivo, el enemigo realiza su acciÃ³n.</li>
<li>Si el jugador muere, el combate termina con derrota.</li>
</ol>
<h3 id="si-el-enemigo-actua-primero">Si el enemigo actÃºa primero:<a class="headerlink" href="#si-el-enemigo-actua-primero" title="Permanent link">&para;</a></h3>
<ol>
<li>El enemigo realiza su acciÃ³n.</li>
<li>Si el jugador muere, termina en derrota.</li>
<li>Si sigue vivo, el jugador ejecuta su turno.</li>
<li>Si el enemigo muere, termina en victoria.</li>
</ol>
<p>Este sistema garantiza que ambos personajes puedan actuar, pero da ventaja a quien tenga mayor velocidad.</p>
<hr />
<h2 id="deteccion-de-dano-y-animacion">ğŸ’¢ DetecciÃ³n de daÃ±o y animaciÃ³n<a class="headerlink" href="#deteccion-de-dano-y-animacion" title="Permanent link">&para;</a></h2>
<p>DespuÃ©s de ejecutar ambos turnos, se compara la salud del enemigo antes y despuÃ©s. Si ha cambiado, se activa una
animaciÃ³n visual en pantalla para indicar que ha recibido daÃ±o. Esta animaciÃ³n se elige aleatoriamente entre varias
disponibles, para darle dinamismo al combate.</p>
<hr />
<h2 id="persistencia-de-las-estadisticas">ğŸ’¾ Persistencia de las estadÃ­sticas<a class="headerlink" href="#persistencia-de-las-estadisticas" title="Permanent link">&para;</a></h2>
<p>Al final del turno, las estadÃ­sticas de ambos personajes se almacenan en sesiÃ³n. TambiÃ©n se incrementa el
contador de turnos del combate y se guarda la instancia en la base de datos. Esto asegura que, incluso si se recarga la
pÃ¡gina, el estado actual del combate se conserva correctamente.</p>
<hr />
<h2 id="renderizado-de-la-vista">ğŸ§¾ Renderizado de la vista<a class="headerlink" href="#renderizado-de-la-vista" title="Permanent link">&para;</a></h2>
<p>La plantilla del combate se renderiza con todos los datos relevantes:</p>
<ul>
<li>EstadÃ­sticas del jugador y del enemigo.</li>
<li>Registro de acciones realizadas durante el turno.</li>
<li>Estado del combate.</li>
<li>Posibles animaciones activadas.</li>
<li>Acciones disponibles para el prÃ³ximo turno.</li>
</ul>
<p>La interfaz refleja todo lo que ocurre durante la batalla, y ofrece una experiencia fluida y visualmente agradable.</p>
<hr />
<h2 id="funciones-clave-utilizadas">ğŸ“ˆ Funciones clave utilizadas<a class="headerlink" href="#funciones-clave-utilizadas" title="Permanent link">&para;</a></h2>
<p>Esta vista depende fuertemente de funciones auxiliares, como:</p>
<ul>
<li>Una funciÃ³n para inicializar el combate. <code>inicializar_combate(request, combate)</code></li>
<li>Otra para aplicar los efectos de turno. <code>registrar_efecto_turno(stats_enemigo, enemigo, log)</code>,
  <code>registrar_efecto_turno(stats_jugador, jugador, log)</code></li>
<li>Una funciÃ³n dedicada al turno del jugador, que interpreta la acciÃ³n y ejecuta su acciÃ³n. <code>ejecutar_turno_jugador(request, jugador, combate, stats_jugador, stats_enemigo, enemigo, accion,
                                               log)</code></li>
<li>Una funciÃ³n similar para el enemigo, basada en una inteligencia artificial. <code>ejecutar_turno_enemigo(request, jugador, stats_jugador, stats_enemigo, enemigo, log,
                                               combate)</code></li>
<li>Funciones que resuelven el combate en caso de victoria o derrota.
  <code>resolver_victoria(request, jugador, enemigo, combate)</code>, <code>resolver_derrota(request, jugador, combate)</code></li>
</ul>
<p>Estas funciones estÃ¡n organizadas en los mÃ³dulos del core (<code>jugador.py</code>, <code>enemigos.py</code>, <code>efectos.py</code>, <code>estadisticas.py</code>,
etc.) y permiten mantener la lÃ³gica bien modularizada.</p>
<hr />
<h2 id="vista-resultado_combate">ğŸ Vista <code>resultado_combate</code><a class="headerlink" href="#vista-resultado_combate" title="Permanent link">&para;</a></h2>
<p>Esta vista se ejecuta inmediatamente despuÃ©s de que el combate termina. Solo se encarga de mostrar al jugador lo que ha
ocurrido:</p>
<ul>
<li>Si ha ganado o perdido.</li>
<li>Calcular la experiencia obtenida y si ha subido de nivel.</li>
</ul>
<p>Se cargan todos los datos desde el modelo <code>Combate</code> y se pasan al contexto para renderizar la plantilla
<code>resultado.html</code>. AquÃ­ no se ejecuta ninguna lÃ³gica, solo presentaciÃ³n.</p>
<hr />
<h2 id="flujo-completo-del-combate">ğŸ”„ Flujo completo del combate<a class="headerlink" href="#flujo-completo-del-combate" title="Permanent link">&para;</a></h2>
<p>[<code>iniciar_combate</code>]<br />
â†“</p>
<p>[<strong>Iniciamos las estadÃ­sticas/ las recuperamos de la sesiÃ³n</strong>]</p>
<p>â†“</p>
<p>[<strong>Aplicamos los estados del enemigo y del jugador</strong>]<br />
â†“</p>
<p>[<strong>Comprobamos victoria o derrota</strong>]<br />
â†“</p>
<p>[<strong>Recogemos la acciÃ³n del jugador</strong>]<br />
â†“</p>
<p>[<strong>Decidimos quien va primero segÃºn la velociadad</strong>]<br />
â†“</p>
<p>[<strong>Ejecutamos los turnos del enemigo y el jugador</strong>]<br />
â†“</p>
<p>[<strong>Comprobamos victoria o derrota</strong>] â† Si nadie gana, se repite el flujo<br />
â†“</p>
<p>[<code>resultado_combate</code>]</p>
<hr />
<h2 id="reflexion">ğŸ§  ReflexiÃ³n<a class="headerlink" href="#reflexion" title="Permanent link">&para;</a></h2>
<p>La vista <code>combate</code> estÃ¡ diseÃ±ada para ofrecer una experiencia tÃ¡ctica rica y detallada, donde cada decisiÃ³n cuenta. Su
lÃ³gica modular permite integrar efectos complejos, decisiones de IA y estadÃ­sticas dinÃ¡micas.</p>
<p>Este sistema se puede ampliar fÃ¡cilmente para incluir nuevas mecÃ¡nicas, como habilidades pasivas avanzadas, efectos en
cadena o enemigos con fases. Es uno de los componentes mÃ¡s completos del proyecto, y demuestra el nivel de integraciÃ³n
entre frontend, backend y lÃ³gica de juego.</p></div>
                <footer>
    <div class="footer-buttons">
        <div class="previous"><a href="../vistas/" title="ğŸ–¥ï¸ Vistas de Django"><span>Previous</span></a></div>
        <div class="next"><a href="../core-jugador/" title="Jugador"><span>Next</span></a></div>
    </div>
    <div class="footer-note">
        <p>
            Built with <a href="http://www.mkdocs.org">MkDocs</a> using
            <a href="https://github.com/daizutabi/mkdocs-ivory">Ivory theme</a>.
        </p>
    </div>
</footer>
            </div>
        </main>
    </div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
    <script src="../search/main.js"></script>
</body>

</html>