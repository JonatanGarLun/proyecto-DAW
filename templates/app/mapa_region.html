{% extends "base.html" %}
{% load static %}
{% block title %}Battlebound Tactics - Región Tranquila{% endblock %}
{% block links %}
	<link rel="stylesheet" href="{% static 'css/mapa_region.css' %}">
{% endblock %}
{% block content %}

    <div class="mapa-container">
        <a class="zona castelvyr" title="Castelvyr" onclick="abrirModal('modal-castillo')"></a>
        <a class="zona thalendor" title="Thalendor" onclick="mostrarDialogo()"></a>
        <a class="zona dreknar" title="Foso Dreknar" onclick="abrirModal('modal-dreknar')"></a>
        <a class="zona brumuhierro" onclick="abrirModal('modal-brumuhierro')"></a>
        <a class="zona bastion" onclick="abrirModal('modal-bastion')"></a>
        <a class="zona surnak" onclick="abrirModal('modal-surnak')"></a>
        <a class="zona campamento" onclick="abrirModal('modal-campamento')"></a>
        <a class="zona vrakk" onclick="abrirModal('modal-vrakk')"></a>
        <a class="zona torreon" onclick="abrirModal('modal-torreon')"></a>
    </div>

    <!-- Modal Castelvyr -->
    <div id="modal-castillo" class="modal">
        <div class="modal-content">
            <h2>Castelvyr</h2>
            <img src="{% static 'resources/imgs/castillo.webp' %}" alt="Castillo"/>
            <a href="{% url 'castlevyr' %}" class="button-gema verde">Acceder</a>
            <a class="button-gema rojo" onclick="cerrarModal('modal-castillo')">Cancelar</a>
        </div>
    </div>

    <!-- Caja de diálogo Thalendor -->
    <div id="dialogo-thalendor" class="dialogo">
        <img id="npc-imagen" src="{% static 'resources/Pixelarts/npcs/npc1.webp' %}" alt="NPC"/>
        <div class="linea">
            <p id="texto-dialogo">...</p>
            <button class="continuar" onclick="cerrarDialogo()">Continuar ></button>
        </div>
    </div>

    <!-- Modal Fosa de Dreknar -->
    <div id="modal-dreknar" class="modal">
        <div class="modal-content">
            <h2>Foso Dreknar</h2>
            <img src="{{ enemigo_dreknar.imagen.url }}" alt="Dreknar" class="img-modal-enemigo"/>
            <p>Enemigo: {{ enemigo_dreknar.nombre }}</p>
            <p>Dificultad: <strong>{{ enemigo_dreknar.dificultad }}</strong></p>
            <a href="{% url 'iniciar_combate' enemigo_dreknar.id %}" class="button-gema verde">Pelear</a>
            <a class="button-gema rojo" onclick="cerrarModal('modal-dreknar')">Retroceder</a>
        </div>
    </div>

    <!-- Modal Brumuhierro -->
    <div id="modal-brumuhierro" class="modal">
        <div class="modal-content">
            <h2>Brumuhierro</h2>
            <img src="{{ enemigo_brumuhierro.imagen.url }}" alt="Brumuhierro" class="img-modal-enemigo"/>
            <p>Enemigo: {{ enemigo_brumuhierro.nombre }}</p>
            <p>Dificultad: <strong>{{ enemigo_brumuhierro.dificultad }}</strong></p>
            <a href="{% url 'iniciar_combate' enemigo_brumuhierro.id %}" class="button-gema verde">Pelear</a>
            <a class="button-gema rojo" onclick="cerrarModal('modal-brumuhierro')">Retroceder</a>
        </div>
    </div>

    <!-- Modal Bastión Carmesí -->
    <div id="modal-bastion" class="modal">
        <div class="modal-content">
            <h2>Bastión Carmesí</h2>
            <img src="{{ enemigo_bastion.imagen.url }}" alt="Bastión" class="img-modal-enemigo"/>
            <p>Enemigo: {{ enemigo_bastion.nombre }}</p>
            <p>Dificultad: <strong>{{ enemigo_bastion.dificultad }}</strong></p>
            <a href="{% url 'iniciar_combate' enemigo_bastion.id %}" class="button-gema verde">Pelear</a>
            <a class="button-gema rojo" onclick="cerrarModal('modal-bastion')">Retroceder</a>
        </div>
    </div>

    <!-- Modal Grieta de Surnak -->
    <div id="modal-surnak" class="modal">
        <div class="modal-content">
            <h2>Grieta Surnak</h2>
            <img src="{{ enemigo_grieta.imagen.url }}" alt="Surnak" class="img-modal-enemigo"/>
            <p>Enemigo: {{ enemigo_grieta.nombre }}</p>
            <p>Dificultad: <strong>{{ enemigo_grieta.dificultad }}</strong></p>
            <a href="{% url 'iniciar_combate' enemigo_grieta.id %}" class="button-gema verde">Pelear</a>
            <a class="button-gema rojo" onclick="cerrarModal('modal-surnak')">Retroceder</a>
        </div>
    </div>

    <!-- Modal Campamento -->
    <div id="modal-campamento" class="modal">
        <div class="modal-content">
            <h2>Campamento de las Sombras Negras</h2>
            <img src="{{ enemigo_campamento.imagen.url }}" alt="Campamento" class="img-modal-enemigo"/>
            <p>Enemigo: {{ enemigo_campamento.nombre }}</p>
            <p>Dificultad: <strong>{{ enemigo_campamento.dificultad }}</strong></p>
            <a href="{% url 'iniciar_combate' enemigo_campamento.id %}" class="button-gema verde">Pelear</a>
            <a class="button-gema rojo" onclick="cerrarModal('modal-campamento')">Retroceder</a>
        </div>
    </div>

    <!-- Modal Nido de Vrakk -->
    <div id="modal-vrakk" class="modal">
        <div class="modal-content">
            <h2>Nido de Vrakk</h2>
            <img src="{{ enemigo_vrakk.imagen.url }}" alt="Vrakk" class="img-modal-enemigo"/>
            <p>Enemigo: {{ enemigo_vrakk.nombre }}</p>
            <p>Dificultad: <strong>{{ enemigo_vrakk.dificultad }}</strong></p>
            <a href="{% url 'iniciar_combate' enemigo_vrakk.id %}" class="button-gema verde">Pelear</a>
            <a class="button-gema rojo" onclick="cerrarModal('modal-vrakk')">Retroceder</a>
        </div>
    </div>

    <!-- Modal Torreón -->
    <div id="modal-torreon" class="modal">
        <div class="modal-content">
            <h2>Torreón del Este</h2>
            <img src="{{ enemigo_torreon.imagen.url }}" alt="Torreón" class="img-modal-enemigo"/>
            <p>Enemigo: {{ enemigo_torreon.nombre }}</p>
            <p>Dificultad: <strong>{{ enemigo_torreon.dificultad }}</strong></p>
            <a href="{% url 'iniciar_combate' enemigo_torreon.id %}" class="button-gema verde">Pelear</a>
            <a class="button-gema rojo" onclick="cerrarModal('modal-torreon')">Retroceder</a>
        </div>
    </div>

    <div id="fade-overlay"></div>

    <script>
        let dialogoBloqueado = false;

        function abrirModal(id) {
            const modal = document.getElementById(id);
            const content = modal.querySelector('.modal-content');
            const dialogoVisible = document.getElementById("dialogo-thalendor").style.display === "flex";
            if (dialogoVisible) return;

            modal.classList.add("active", "animar-modal");
            content.classList.add("animar-modal");

            setTimeout(() => {
                modal.classList.remove("animar-modal");
                content.classList.remove("animar-modal");
            }, 400);
        }

        function cerrarModal(id) {
            const modal = document.getElementById(id);
            const content = modal.querySelector('.modal-content');

            modal.classList.add("cerrar-animacion");
            content.classList.add("cerrar-animacion");

            setTimeout(() => {
                modal.classList.remove("active", "cerrar-animacion");
                content.classList.remove("cerrar-animacion");
            }, 300);
        }

        function mostrarDialogo() {
            if (dialogoBloqueado) return;

            dialogoBloqueado = true;

            const frases = [
                "No queremos a extraños en Thalendor!",
                "Una mente entrenada es más poderosa que cualquier arma.",
                "Cuidado con lo que acecha entre las sombras, nunca se sabe cuando un enemigo puede estar observando.",
                "El rey Havva Eskript fue desterrado por reinar como un tirano, fue mandado a la dimensión oscura para toda la eternidad",
                "Muchos hablan de que el rey Havva Eskript era bastante poderoso y que era uno de los mejores luchadores de todos los tiempos, aunque la última vez que fue visto estaba bastante mayor.",
                "Se dice que el reino del este enfadó a un poderoso hechizero y éste lo congeló como castigo.",
                "Las ruinas antiguas esconden secretos que nadie debería despertar.",
                "Tendrás que ser fuerte para lo que viene, joven aventurero.",
                "Esos Duendes Chillones son muy débiles, hasta un crío podría derrotar a uno.",
                "Recuerda tener tus armas y equipo al día, nunca se está suficiente preparado.",
                "El puente que conectaba nuestro reino con el reino del sur ha caído, no hay manera de acceder a él de momento",
                "Se dice que grandes desafios aguardan en el reino volcánico, pero yo no estoy dispuesto a comprobarlo.",
                "¿Qué crees que se encuentre en el castillo tenebroso, quién habrá decidido colocarlo ahí?",

            ];

            const imagenes = [
                "{% static 'resources/Pixelarts/npcs/npc1.webp' %}",
                "{% static 'resources/Pixelarts/npcs/npc2.webp' %}",
                "{% static 'resources/Pixelarts/npcs/npc3.webp' %}",
                "{% static 'resources/Pixelarts/npcs/npc4.webp' %}",
                "{% static 'resources/Pixelarts/npcs/npc5.webp' %}",
                "{% static 'resources/Pixelarts/npcs/npc6.webp' %}"
            ];

            const frase = frases[Math.floor(Math.random() * frases.length)] || frases[0];
            const imagen = imagenes[Math.floor(Math.random() * imagenes.length)] || imagenes[0];

            document.getElementById("texto-dialogo").innerText = frase;
            document.getElementById("npc-imagen").src = imagen;
            document.getElementById("dialogo-thalendor").style.display = "flex";

            setTimeout(() => {
                dialogoBloqueado = false;
            }, 3000);
        }

        function cerrarDialogo() {
            dialogoBloqueado = false;
            document.getElementById("dialogo-thalendor").style.display = "none";
        }
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const overlay = document.getElementById("fade-overlay");
            if (!overlay) return;

            overlay.style.opacity = '1';
            overlay.style.pointerEvents = 'auto';
            setTimeout(() => {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    overlay.style.pointerEvents = 'none';
                }, 400);
            }, 50);

            document.querySelectorAll('.button-gema.verde').forEach(boton => {
                boton.addEventListener('click', (e) => {
                    const href = boton.getAttribute("href");
                    if (!href || href === "#") return;

                    e.preventDefault();
                    overlay.style.opacity = '1';
                    overlay.style.pointerEvents = 'auto';

                    setTimeout(() => {
                        window.location.href = href;
                    }, 500);
                });
            });
        });

        window.addEventListener("pageshow", () => {
            const overlay = document.getElementById("fade-overlay");
            if (!overlay) return;

            overlay.style.opacity = '1';
            overlay.style.pointerEvents = 'auto';

            setTimeout(() => {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    overlay.style.pointerEvents = 'none';
                }, 400);
            }, 50);
        });
    </script>
{% endblock %}
